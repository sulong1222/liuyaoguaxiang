<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六爻智能解卦系统</title>
    <style>
        :root {
            --primary-color: #8b4513;
            --secondary-color: #d4af37;
            --bg-color: #f0e6d3;
        }
        body {
            font-family: '楷体', cursive;
            background: var(--bg-color);
            color: var(--primary-color);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: rgba(255,255,255,0.9);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        button {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        .hexagram-box {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(139,69,19,0.1);
            border-radius: 8px;
        }
        .yao-line {
            font-size: 1.8rem;
            line-height: 1.5;
            margin: 0.5rem 0;
        }
        .changing-yao {
            color: #b22222;
            position: relative;
        }
        .changing-yao::after {
            content: "✦";
            position: absolute;
            right: -1.2rem;
            color: #ffd700;
        }
        .tabs {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .tab {
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            background: var(--secondary-color);
            color: white;
            transition: all 0.3s;
        }
        .tab.active {
            background: var(--primary-color);
        }
        .interpretation {
            line-height: 1.8;
        }
        .element-tag {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🀄 六爻智能解卦系统</h1>
        <button onclick="generateHexagram()">🙏 诚心摇卦</button>
        <div id="result"></div>
    </div>

<script>
// 完整六十四卦数据库
const hexagramDict = {
  // 上经三十卦
  '111111': { name: '乾为天', desc: '元亨利贞。', yao: [
    '初九：潜龙，勿用。',
    '九二：见龙在田，利见大人。',
    '九三：君子终日乾乾，夕惕若，厉无咎。',
    '九四：或跃在渊，无咎。',
    '九五：飞龙在天，利见大人。',
    '上九：亢龙有悔。'
  ]},
  '000000': { name: '坤为地', desc: '君子以厚德载物。', yao: [
    '初六：履霜，坚冰至。',
    '六二：直方大，不习无不利。',
    '六三：含章可贞，或从王事，无成有终。',
    '六四：括囊，无咎无誉。',
    '六五：黄裳，元吉。',
    '上六：龙战于野，其血玄黄。'
  ]},
  '100010': { name: '水雷屯', desc: '刚柔始交而难生，动乎险中，大亨贞。' },
  '010001': { name: '山水蒙', desc: '山下出泉，蒙；君子以果行育德。' },
  '111010': { name: '水天需', desc: '云上于天，需；君子以饮食宴乐。' },
  '010111': { name: '天水讼', desc: '天与水违行，讼；君子以作事谋始。' },
  '010000': { name: '地水师', desc: '君子以容民畜众。' },
  '000010': { name: '水地比', desc: '地上有水，比；先王以建万国，亲诸侯。' },
  '111011': { name: '风天小畜', desc: '风行天上，小畜；君子以懿文德。' },
  '110111': { name: '天泽履', desc: '上天下泽，履；君子以辨上下，定民志。' },
  '111000': { name: '地天泰', desc: '天地交，泰；后以财成天地之道，辅相天地之宜，以左右民。' },
  '000111': { name: '天地否', desc: '天地不交，否；君子以俭德辟难，不可荣以禄。' },
  '101111': { name: '天火同人', desc: '天与火，同人；君子以类族辨物。' },
  '111101': { name: '火天大有', desc: '火在天上，大有；君子以遏恶扬善，顺天休命。' },
  '001000': { name: '地山谦', desc: '君子以裒多益寡，称物平施。' },
  '000100': { name: '雷地豫', desc: '雷出地奋，豫；先王以作乐崇德，殷荐之上帝，以配祖考。' },
  '110001': { name: '泽雷随', desc: '君子以向晦入宴息。' },
  '100011': { name: '山风蛊', desc: '君子以振民育德。' },
  '110000': { name: '地泽临', desc: '君子以教思无穷，容保民无疆。' },
  '000011': { name: '风地观', desc: '风行地上，观；先王以省方，观民设教。' },
  '100101': { name: '火雷噬嗑', desc: '雷电噬嗑；先王以明罚敕法。' },
  '101001': { name: '山火贲', desc: '君子以明庶政，无敢折狱。' },
  '000001': { name: '山地剥', desc: '山附于地，剥；上以厚下安宅。' },
  '100000': { name: '地雷复', desc: '雷在地中，复；先王以至日闭关，商旅不行。' },
  '100111': { name: '天雷无妄', desc: '天下雷行，物与无妄；先王以茂对时，育万物。' },
  '111001': { name: '山天大畜', desc: '天在山中，大畜；君子以多识前言往行，以畜其德。' },
  '100001': { name: '山雷颐', desc: '君子以慎言语，节饮食。' },
  '011110': { name: '泽风大过', desc: '君子以独立不惧，遁世无闷。' },
  '010010': { name: '坎为水', desc: '水洊至，习坎；君子以常德行，习教事。' },
  '101101': { name: '离为火', desc: '明两作，离；大人以继明照于四方。' },

  // 下经三十四卦
  '001110': { name: '泽山咸', desc: '君子以虚受人。' },
  '011100': { name: '雷风恒', desc: '君子以立不易方。' },
  '111110': { name: '天山遁', desc: '君子以远小人，不恶而严。' },
  '011111': { name: '雷天大壮', desc: '君子以非礼弗履。' },
  '000101': { name: '火地晋', desc: '君子以自昭明德。' },
  '101000': { name: '地火明夷', desc: '君子以莅众，用晦而明。' },
  '110101': { name: '风火家人', desc: '君子以言有物而行有恒。' },
  '101011': { name: '火泽睽', desc: '君子以同而异。' },
  '001010': { name: '水山蹇', desc: '君子以反身修德。' },
  '010100': { name: '雷水解', desc: '君子以赦过宥罪。' },
  '110001': { name: '山泽损', desc: '君子以惩忿窒欲。' },
  '100011': { name: '风雷益', desc: '君子以见善则迁，有过则改。' },
  '111110': { name: '泽天夬', desc: '君子以施禄及下，居德则忌。' },
  '011111': { name: '天风姤', desc: '后以施命诰四方。' },
  '000110': { name: '泽地萃', desc: '君子以除戎器，戒不虞。' },
  '011000': { name: '地风升', desc: '君子以顺德，积小以高大。' },
  '010110': { name: '泽水困', desc: '君子以致命遂志。' },
  '011010': { name: '水风井', desc: '君子以劳民劝相。' },
  '101110': { name: '泽火革', desc: '君子以治历明时。' },
  '011101': { name: '火风鼎', desc: '君子以正位凝命。' },
  '100100': { name: '震为雷', desc: '君子以恐惧修省。' },
  '001001': { name: '艮为山', desc: '君子以思不出其位。' },
  '001011': { name: '风山渐', desc: '君子以居贤德善俗。' },
  '110100': { name: '雷泽归妹', desc: '君子以永终知敝。' },
  '101100': { name: '雷火丰', desc: '君子以折狱致刑。' },
  '001101': { name: '火山旅', desc: '君子以明慎用刑而不留狱。' },
  '011001': { name: '巽为风', desc: '君子以申命行事。' },
  '100110': { name: '兑为泽', desc: '君子以朋友讲习。' },
  '011000': { name: '风水涣', desc: '先王以享于帝立庙。' },
  '000110': { name: '水泽节', desc: '君子以制数度，议德行。' },
  '110110': { name: '风泽中孚', desc: '君子以议狱缓死。' },
  '001001': { name: '雷山小过', desc: '君子以行过乎恭，丧过乎哀，用过乎俭。' },
  '101010': { name: '水火既济', desc: '君子以思患而豫防之。' },
  '010101': { name: '火水未济', desc: '君子以慎辨物居方。' }
};

// 五行生克关系
const ELEMENT_RELATIONS = {
    '金': { generate: '水', restrict: '木' },
    '木': { generate: '火', restrict: '土' },
    '水': { generate: '木', restrict: '火' },
    '火': { generate: '土', restrict: '金' },
    '土': { generate: '金', restrict: '水' }
};

class HexagramSystem {
    constructor() {
        this.current = null;
    }

    // 生成卦象（含变爻）
    generate() {
        let hexKey = '';
        const changes = [];
        
        for(let i=0; i<6; i++) {
            const rand = Math.floor(Math.random() * 6); // 模拟铜钱概率
            const state = this.getYaoState(rand);
            hexKey += state.value;
            if(state.changing) changes.push(i);
        }
        
        this.current = {
            original: this.getHexData(hexKey),
            changingLines: changes,
            changed: this.getChangedHex(hexKey, changes)
        };
    }

    getYaoState(num) {
        // 0-3对应：少阴(0)、少阳(1)、老阴(2)、老阳(3)
        return {
            0: {value:0, changing:false},
            1: {value:1, changing:false},
            2: {value:0, changing:true}, // 老阴变阳
            3: {value:1, changing:true}, // 老阳变阴
            4: {value:0, changing:false},
            5: {value:1, changing:false}
        }[num];
    }

    getHexData(key) {
        return HEXAGRAM_DB[key] || {name: '未知卦', element: '', advice: {}};
    }

    getChangedHex(originalKey, changes) {
        if(changes.length === 0) return null;
        const arr = originalKey.split('');
        changes.forEach(pos => {
            arr[pos] = arr[pos] === '1' ? '0' : '1';
        });
        return this.getHexData(arr.join(''));
    }

    // 生成解卦报告
    generateReport(type = 'overall') {
        const { original, changed, changingLines } = this.current;
        const elementAnalysis = this.analyzeElements(original, changed);
        
        return `
            <h3>${original.name} ${this.getElementTag(original.element)}</h3>
            ${this.renderHexagram(original, changingLines)}
            ${changed ? `<p class="changed">变卦：${changed.name}</p>` : ''}
            
            <div class="tabs">
                ${['overall', 'career', 'love', 'health'].map(t => `
                    <div class="tab ${t === type ? 'active' : ''}" 
                         onclick="hexSystem.showTab('${t}')">${this.getTabName(t)}</div>
                `).join('')}
            </div>
            
            <div class="interpretation">
                ${this.getAdviceContent(original, type)}
                ${elementAnalysis}
                ${this.getChangingTips(changingLines)}
            </div>
        `;
    }

    getElementTag(element) {
        const colors = {金:'#ffd700',木:'#228b22',水:'#1e90ff',火:'#ff4500',土:'#cd853f'};
        return `<span class="element-tag" style="background:${colors[element]}">${element}行</span>`;
    }

    renderHexagram(hex, changes) {
        return hex.name.split('').reverse().map((_, i) => {
            const yao = hex.key[5-i]; // 从下到上显示
            return `<div class="yao-line ${changes.includes(5-i) ? 'changing-yao' : ''}">
                ${yao === '1' ? '▅▅▅▅▅' : '▅▅　▅▅'}
            </div>`;
        }).join('');
    }

    analyzeElements(original, changed) {
        if(!changed) return '';
        const oElem = original.element;
        const cElem = changed.element;
        const relation = ELEMENT_RELATIONS[oElem];
        
        let analysis = '';
        if(relation.generate === cElem) analysis = '🟢 五行相生（吉）';
        else if(relation.restrict === cElem) analysis = '🔴 五行相克（凶）';
        else analysis = '🟡 五行平和（中）';
        
        return `<div class="element-analysis">${analysis}</div>`;
    }

    getChangingTips(changes) {
        if(changes.length === 0) return '';
        return `<div class="changing-tips">
            <h4>动爻解析：</h4>
            <ul>${changes.map(pos => `
                <li>第${pos+1}爻（${this.current.original.relations[pos]}）：
                ${this.current.original.changingTips?.[pos] || '无特别提示'}</li>
            `).join('')}</ul>
        </div>`;
    }

    getAdviceContent(hex, type) {
        return `<div class="advice-content">
            <h4>${this.getTabName(type)}建议：</h4>
            <p>${hex.advice[type] || '暂无专项建议'}</p>
        </div>`;
    }

    getTabName(type) {
        return {overall:'整体', career:'事业', love:'感情', health:'健康'}[type];
    }

    showTab(type) {
        document.getElementById('result').innerHTML = this.generateReport(type);
    }
}

// 初始化系统
const hexSystem = new HexagramSystem();

function generateHexagram() {
    hexSystem.generate();
    hexSystem.showTab('overall');
}
</script>
</body>
</html>
